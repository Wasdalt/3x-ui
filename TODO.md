# TODO ‚Äî –ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏ 3x-ui

## üî¥ –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

### –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
**–ü—Ä–æ–±–ª–µ–º–∞:** `Limit IP` —Å—á–∏—Ç–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ IP, –Ω–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞. –ö–ª–∏–µ–Ω—Ç—ã –∑–∞ NAT —Å—á–∏—Ç–∞—é—Ç—Å—è –∫–∞–∫ 1.

**–í–æ–∑–º–æ–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è:**
1. **JA3/JA4 TLS Fingerprinting**
   - –°–æ–±–∏—Ä–∞—Ç—å –æ—Ç–ø–µ—á–∞—Ç–∫–∏ TLS handshake
   - Nginx + lua-resty-ja3 –∏–ª–∏ HAProxy
   - –¢–æ—á–Ω–æ—Å—Ç—å ~90%

2. **HTTP/2 Fingerprinting**
   - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã SETTINGS, WINDOW_UPDATE
   - –¢—Ä–µ–±—É–µ—Ç –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ Xray

3. **TCP Fingerprinting**
   - TTL, window size, TCP options
   - p0f –∏–ª–∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

4. **Middleware –ø–µ—Ä–µ–¥ Xray**
   ```
   –ö–ª–∏–µ–Ω—Ç ‚Üí [Fingerprint Collector] ‚Üí Xray
                    ‚Üì
              PostgreSQL/Redis
   ```

**–†–µ—Å—É—Ä—Å—ã:**
- https://github.com/salesforce/ja3
- https://github.com/lwthiker/curl-impersonate

---

### –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π routing –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤
**–ò–¥–µ—è:** –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å routing rule.

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
1. –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å `inboundService.AddClient()` –≤ Go
2. –î–æ–±–∞–≤–∏—Ç—å outbound proxy –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞
3. –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞ ‚Äî —É–¥–∞–ª—è—Ç—å rule

**Use cases:**
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ Squid proxy
- –†–∞–∑–Ω—ã–π routing –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∞—Ä–∏—Ñ–æ–≤
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å–∞–π—Ç–æ–≤ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

---

## üü° –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞
**–í–∞—Ä–∏–∞–Ω—Ç—ã:**
1. `tc` (traffic control) –Ω–∞ Linux ‚Äî –ø–æ IP –∫–ª–∏–µ–Ω—Ç–∞
2. Squid proxy –∫–∞–∫ outbound —Å delay pools
3. Xray policy ‚Üí –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç rate limiting

### Webhook –ø—Ä–∏ —Å–æ–±—ã—Ç–∏—è—Ö
- –°–æ–∑–¥–∞–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
- –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤
- –ò—Å—Ç–µ—á–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏

---

## üü¢ –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

### –ê–≤—Ç–æ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ GeoIP/GeoSite
Cron job –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–∑ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ Prometheus
–≠–∫—Å–ø–æ—Ä—Ç –º–µ—Ç—Ä–∏–∫ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Prometheus

### Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º
- –¢–æ–ø –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π —Ç—Ä–∞—Ñ–∏–∫–∞

---

## –ó–∞–º–µ—Ç–∫–∏

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–π Go:
```
web/service/
‚îú‚îÄ‚îÄ inbound.go      ‚Üê AddClient, DelClient
‚îú‚îÄ‚îÄ setting.go      ‚Üê –ù–∞—Å—Ç—Ä–æ–π–∫–∏
‚îî‚îÄ‚îÄ user.go         ‚Üê –ê–¥–º–∏–Ω—ã

xray/
‚îú‚îÄ‚îÄ config.go       ‚Üê –ö–æ–Ω—Ñ–∏–≥ Xray
‚îî‚îÄ‚îÄ process.go      ‚Üê –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–º
```

### –ö–∞–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è Go:
```bash
# –õ–æ–∫–∞–ª—å–Ω–∞—è —Å–±–æ—Ä–∫–∞
go build -o x-ui main.go

# Docker —Å–±–æ—Ä–∫–∞
docker build -t 3x-ui-custom .
```
