# ============================================================================
# 3X-UI Docker Конфигурация
# ============================================================================
# Скопируйте этот файл в .env и отредактируйте под свой сервер:
#   cp .env.example .env
#   nano .env
# ============================================================================

# ============================================================================
# ОСНОВНЫЕ НАСТРОЙКИ
# ============================================================================

# Порт веб-панели (HTTPS)
XUI_PORT=2053

# Домен панели (SSL сертификаты формируются автоматически)
# Пример: panel.example.com
XUI_DOMAIN=panel.example.com

# Email администратора (для Let's Encrypt уведомлений об истечении)
XUI_ADMIN_EMAIL=admin@example.com

# Базовый путь панели (для скрытия URL)
# Примеры: / или /secretpath/
# ВАЖНО: путь должен начинаться и заканчиваться на /
XUI_BASE_PATH=/

# ============================================================================
# РЕЖИМ ДОСТУПА (HTTP/HTTPS)
# ============================================================================
# Если домен не указан или SSL не настроен — панель работает на HTTP
# Это позволяет получить доступ через IP сервера (небезопасно, только для настройки!)
#
# true  — разрешить HTTP доступ по IP (http://server-ip:2053)
# false — только HTTPS с доменом (по умолчанию)
# XUI_ALLOW_HTTP=false

# ============================================================================
# УЧЁТНЫЕ ДАННЫЕ АДМИНИСТРАТОРА
# ============================================================================
# Если указаны — применяются при каждом запуске
# Если не указаны — используются из БД (бэкап) или дефолт 3x-ui (admin/admin)

# Логин администратора
# XUI_ADMIN_USERNAME=admin

# Пароль администратора (будет захэширован)
# XUI_ADMIN_PASSWORD=admin

# Секретный ключ панели (для session/cookies)
# XUI_SECRET_KEY=my-super-secret-key

# ============================================================================
# SSL СЕРТИФИКАТЫ
# ============================================================================
# По умолчанию пути формируются автоматически из XUI_DOMAIN:
#   /etc/letsencrypt/live/${XUI_DOMAIN}/fullchain.pem
#   /etc/letsencrypt/live/${XUI_DOMAIN}/privkey.pem
#
# Раскомментируйте ТОЛЬКО если пути нестандартные:
# XUI_CERT_FILE=/custom/path/fullchain.pem
# XUI_KEY_FILE=/custom/path/privkey.pem

# ============================================================================
# ПОДПИСКА (Subscription Server)
# ============================================================================

# Порт сервера подписок (HTTPS)
XUI_SUB_PORT=2096

# Путь подписок (должен начинаться и заканчиваться на /)
XUI_SUB_PATH=/sub/

# Включить сервер подписок
XUI_SUB_ENABLE=true

# Отдельный домен для подписки (опционально)
# Если указан — автоматически выпускается отдельный сертификат
# Если не указан — используется XUI_DOMAIN
# XUI_SUB_DOMAIN=sub.example.com

# ============================================================================
# БЕЗОПАСНОСТЬ
# ============================================================================

# Таймаут сессии панели (минуты)
XUI_SESSION_TIMEOUT=60

# Часовой пояс сервера (по умолчанию Local = UTC)
# XUI_TIMEZONE=Europe/Moscow

# ============================================================================
# XRAY ЛОГИРОВАНИЕ
# ============================================================================
# Путь к access log (включает логирование для torrent/iplimit блокировщиков)
# Значение: ./access.log — создаёт файл в /app/access.log
# ВАЖНО: Эта настройка применяется ОДИН РАЗ при первом запуске!
# Для изменения потом используйте панель: Настройки → Xray → Access Log
XUI_XRAY_ACCESS_LOG=./access.log

# ============================================================================
# ЗАЩИТА IP ЛИМИТОВ — ВЫБЕРИТЕ ОДИН РЕЖИМ!
# ============================================================================
# ВНИМАНИЕ: Используйте только ОДИН режим! Если оба включены — двойная блокировка.

# --- РЕЖИМ 1: Fail2ban (по умолчанию) ---
# Автоматическая блокировка без внешних сервисов
# Работает сразу, дополнительные контейнеры НЕ нужны
# XUI_ENABLE_FAIL2BAN=true           # вкл/выкл (по умолчанию true)
# XUI_FAIL2BAN_BANTIME=30            # длительность бана (минуты)
# XUI_FAIL2BAN_MAXRETRY=2            # нарушений до бана
# XUI_FAIL2BAN_FINDTIME=32           # окно времени (секунды)

# --- РЕЖИМ 2: Webhook + xray-iplimit-blocker ---
# Отправляет нарушения на ваш API для принятия решения
# ТРЕБУЕТ: docker-compose --profile iplimit up -d
# ВАЖНО: Если используете РЕЖИМ 2, выключите РЕЖИМ 1 (XUI_ENABLE_FAIL2BAN=false)
# XUI_ENABLE_FAIL2BAN=false          # ← ВЫКЛЮЧИТЕ при использовании webhook
# XUI_IP_WEBHOOK_ENABLE=true         # вкл/выкл webhook
# XUI_IP_WAIT_WEBHOOK=true           # ждать ответ перед блокировкой
# XUI_IP_WEBHOOK_URL=https://...     # URL вашего API
# XUI_IP_WEBHOOK_TIMEOUT=5           # таймаут ответа (секунды)
# XUI_IP_DEFAULT_ACTION=ban          # действие по умолчанию: ban/ignore/warn
#   ban    - блокировать IP (по умолчанию)
#   ignore - только логировать, без блокировки
#   warn   - логировать с предупреждением
# XUI_IP_LOG_FILE=/var/log/3xipl.log # путь к логу нарушений
# XUI_FAIL2BAN_BANTIME=30            # fallback длительность бана (если webhook не вернул)

# ============================================================================
# БЛОКИРОВКА ТОРРЕНТОВ (xray-torrent-blocker)
# ЗАПУСК: docker-compose --profile torrent up -d
# ============================================================================
# В панели включите Access Log: Настройки → Xray → Access Log → ./access.log

# --- Основные настройки ---
# XUI_TORRENT_LOG_FILE=/app/xray-logs/access.log  # Путь к логам Xray
# XUI_TORRENT_BAN_DURATION=10                     # Блокировка (минуты)
# XUI_TORRENT_BLOCK_MODE=iptables                 # iptables или nft

# --- Webhook для внешней модерации ---
# XUI_TORRENT_WEBHOOK_ENABLE=false       # вкл/выкл webhook
# XUI_TORRENT_WAIT_WEBHOOK=false         # ждать ответ перед блокировкой
# XUI_TORRENT_WEBHOOK_URL=https://...    # URL вашего API
# XUI_TORRENT_WEBHOOK_TIMEOUT=5          # таймаут (секунды)

# ВАЖНО: Нужно настроить routing в Xray для тега "TORRENT"
# и outbound blackhole с этим тегом. См. README torrent-blocker.
